<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è¦–è¦ºè¿½è¹¤éŠæˆ² - å°ˆæ¥­æ•™å­¸ç‰ˆ</title>
    <style>
        /* åŸºç¤è¨­å®šï¼šå…¨é»‘èƒŒæ™¯ï¼Œé˜²æ­¢æ²å‹• */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            color: yellow;
            font-family: 'PingFang HK', 'Microsoft JhengHei', sans-serif;
            overflow: hidden;
            touch-action: none; /* ç¦æ­¢ iPad ç¸®æ”¾èˆ‡æ²å‹• */
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* --- ç§»å‹•ç‰©ä»¶æ¨£å¼ --- */
        .object-wrapper {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: 350px; /* è§¸æ§æ„Ÿæ‡‰å€å¤§å° */
            height: 350px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            /* è®“è§¸æ§æ›´éˆæ• */
            -webkit-tap-highlight-color: transparent;
        }

        /* å·¨å¤§çš„åœ–æ¡ˆ (Emoji) */
        .item-icon {
            font-size: 13rem;
            user-select: none;
            z-index: 3;
            /* å¹³æ»‘éæ¸¡å‹•ç•« */
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* æˆåŠŸæ™‚çš„å½ˆè·³å‹•ç•« */
        @keyframes success-pop {
            0% { transform: scale(1); }
            40% { transform: scale(1.8) rotate(15deg); filter: drop-shadow(0 0 30px white); }
            70% { transform: scale(1.1) rotate(-10deg); }
            100% { transform: scale(1.2); }
        }

        .success-active .item-icon {
            animation: success-pop 0.8s forwards;
        }

        /* --- é€²åº¦åœ“ç’° (SVG) --- */
        .progress-ring {
            position: absolute;
            z-index: 1;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åœ“ç’°ç›´é”åœ–æ¡ˆ */
        }

        .progress-ring svg {
            width: 400px;
            height: 400px;
        }

        .progress-ring circle {
            fill: transparent;
            stroke: rgba(255, 255, 255, 0.7); /* åŠé€æ˜ç™½è‰²å…‰ç’° */
            stroke-width: 14;
            /* åœ“å‘¨é•·è¨ˆç®—: 2 * PI * r(170) â‰ˆ 1068 */
            stroke-dasharray: 1068;
            stroke-dashoffset: 1068; /* åˆå§‹éš±è— */
            stroke-linecap: round;
        }

        /* --- ç‰¹æ•ˆå±¤ --- */
        /* 1. æˆåŠŸæ™‚çš„ç™½å…‰é–ƒçˆ */
        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }

        .flash-active {
            animation: flash-anim 0.6s ease-out;
        }

        @keyframes flash-anim {
            0% { opacity: 0.5; }
            100% { opacity: 0; }
        }

        /* 2. æœ€çµ‚æ…¶ç¥çš„å½©è‰²çµ²å¸¶ */
        #confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 8;
        }

        .confetti {
            position: absolute;
            width: 12px;
            height: 25px;
            opacity: 0.8;
            top: -50px;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(110vh) rotate(720deg); }
        }

        /* --- ä»‹é¢èˆ‡è¨­å®šé é¢ --- */
        #start-screen {
            position: absolute;
            z-index: 10;
            background: black;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .settings-panel {
            margin-bottom: 40px;
            background: rgba(255,255,255,0.1); /* æ·±ç°åŠé€æ˜èƒŒæ™¯ */
            padding: 30px;
            border-radius: 30px;
            border: 2px solid #555;
            width: 80%;
            max-width: 600px;
        }

        .speed-options {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 20px;
        }

        .speed-btn {
            flex: 1;
            padding: 20px 10px;
            font-size: 1.5rem;
            background: #444;
            color: white;
            border: 3px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        /* é¸ä¸­ç‹€æ…‹ */
        .speed-btn.active {
            background: #ff4500; /* æ©™ç´…è‰² */
            border-color: yellow;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.5);
        }

        .main-start-btn {
            padding: 25px 80px;
            font-size: 2.5rem;
            background: #FFD700; /* é‡‘é»ƒè‰² */
            color: black;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 0 #b8860b;
            transition: transform 0.1s;
        }

        .main-start-btn:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 #b8860b;
        }

        /* ä¸‹ä¸€å€‹æŒ‰éˆ• */
        #next-btn {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 6;
            background: #00FF7F; /* æ˜¥ç¶ è‰² */
            padding: 20px 60px;
            font-size: 2.2rem;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            color: black;
            box-shadow: 0 8px 0 #008f47;
            cursor: pointer;
        }

        #next-btn:active {
            transform: translate(-50%, 4px);
            box-shadow: 0 4px 0 #008f47;
        }
    </style>
</head>
<body>

    <!-- ç‰¹æ•ˆå±¤ -->
    <div id="flash-overlay"></div>
    <div id="confetti-container"></div>

    <!-- é–‹å§‹èˆ‡è¨­å®šç•«é¢ -->
    <div id="start-screen">
        <h1 style="font-size: 3.5rem; color: yellow; margin-bottom: 30px;">çœ¼ç›çœ‹çœ‹å°å‹•ç‰© ğŸ‘ï¸</h1>
        
        <div class="settings-panel">
            <div style="font-size: 1.8rem; color: white;">é¸æ“‡ç§»å‹•é€Ÿåº¦ï¼š</div>
            <div class="speed-options">
                <!-- é è¨­é¸ä¸­'ä¸­é€Ÿ' -->
                <button class="speed-btn" onclick="setSpeed('slow', this)">æ…¢<br><span style="font-size:1rem">Slow</span></button>
                <button class="speed-btn active" onclick="setSpeed('medium', this)">ä¸­<br><span style="font-size:1rem">Medium</span></button>
                <button class="speed-btn" onclick="setSpeed('fast', this)">å¿«<br><span style="font-size:1rem">Fast</span></button>
            </div>
        </div>

        <button class="main-start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="game-container">
        <div id="current-object" class="object-wrapper">
            <!-- é€²åº¦åœˆ -->
            <div class="progress-ring">
                <svg>
                    <circle id="loading-circle" r="170" cx="200" cy="200"></circle>
                </svg>
            </div>
            <!-- Emoji åœ–æ¡ˆ -->
            <div id="icon" class="item-icon"></div>
        </div>
        
        <!-- ç¶ è‰²ä¸‹ä¸€å€‹æŒ‰éˆ• -->
        <button id="next-btn" onclick="nextItem()">ä¸‹ä¸€å€‹ &#10132;</button>
    </div>

    <script>
        // --- éŠæˆ²è³‡æ–™è¨­å®š ---
        const items = [
            { name: 'å°é³¥å…’', icon: 'ğŸ¦' },
            { name: 'å°é’è›™', icon: 'ğŸ¸' },
            { name: 'å°é›¨é»', icon: 'ğŸŒ§ï¸' },
            { name: 'å°é›', icon: 'ğŸ¥' },
            { name: 'å¤ªé™½', icon: 'â˜€ï¸' }
        ];

        // è®šè³èªåº«
        const praiseWords = ["å¥½å»å•Šï¼", "ä½ åšå¾—åˆ°ï¼", "å¥½æ£’å•Šï¼", "çœŸä¿‚è°æ˜ï¼", "å¤ªå²å®³äº†ï¼"];
        // çµ²å¸¶é¡è‰²åº«
        const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500'];

        // --- è®Šæ•¸åˆå§‹åŒ– ---
        let currentIndex = 0;
        let isGazing = false; // æ˜¯å¦æ­£åœ¨æ³¨è¦–/æŒ‰ä½
        let gazeStartTime = 0;
        const gazeDuration = 1000; // éœ€è¦æ³¨è¦–çš„æ™‚é–“ (æ¯«ç§’)
        let isCompleted = false;

        // é€Ÿåº¦åƒæ•¸ (åƒç´ /å¹€)
        let currentSpeedFactor = 2.8; // é è¨­ä¸­é€Ÿ
        const speedMap = {
            'slow': 1.2,
            'medium': 2.8,
            'fast': 5.0
        };

        // ç§»å‹•ç‰©ç†é‡
        let posX, posY, velX, velY;
        const objSize = 400; // ç‰©ä»¶å®¹å™¨å¤§å°ï¼Œç”¨æ–¼é‚Šç•Œè¨ˆç®—

        // DOM å…ƒç´ ç·©å­˜
        const iconEl = document.getElementById('icon');
        const circleEl = document.getElementById('loading-circle');
        const nextBtn = document.getElementById('next-btn');
        const wrapper = document.getElementById('current-object');
        const flashOverlay = document.getElementById('flash-overlay');
        const confettiContainer = document.getElementById('confetti-container');
        const circleTotalLength = 1068; // å°æ‡‰ CSS stroke-dasharray

        // --- è¨­å®šåŠŸèƒ½ ---
        function setSpeed(speed, btn) {
            currentSpeedFactor = speedMap[speed];
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // èªéŸ³åé¥‹è¨­å®š
            let speedName = speed === 'slow' ? 'æ…¢é€Ÿ' : speed === 'medium' ? 'ä¸­é€Ÿ' : 'å¿«é€Ÿ';
            speak(speedName);
        }

        // --- éŠæˆ²æµç¨‹æ§åˆ¶ ---
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            // è§¸ç™¼ä¸€æ¬¡ç©ºçš„èªéŸ³ä»¥è§£é–ç€è¦½å™¨è‡ªå‹•æ’­æ”¾é™åˆ¶
            speak(""); 
            loadItem();
            animate();
        }

        function loadItem() {
            isCompleted = false;
            nextBtn.style.display = 'none';
            wrapper.classList.remove('success-active'); // ç§»é™¤æˆåŠŸå‹•ç•«
            
            const current = items[currentIndex];
            iconEl.textContent = current.icon;
            
            // éš¨æ©Ÿåˆå§‹ä½ç½® (ç¢ºä¿ä¸æœƒç”Ÿåœ¨è¢å¹•å¤–)
            posX = Math.random() * (window.innerWidth - objSize) + objSize/2;
            posY = Math.random() * (window.innerHeight - objSize) + objSize/2;
            
            // æ ¹æ“šè¨­å®šçš„é€Ÿåº¦è¨ˆç®—éš¨æ©Ÿæ–¹å‘
            velX = (Math.random() > 0.5 ? 1 : -1) * (currentSpeedFactor + Math.random() * 0.5);
            velY = (Math.random() > 0.5 ? 1 : -1) * (currentSpeedFactor + Math.random() * 0.5);

            resetCircle();
            speak(`å»æµä¸‹ ${current.name} å–ºé‚Šåº¦ï¼Ÿ`);
        }

        function resetCircle() {
            // é‡ç½®é€²åº¦æ¢ç‚ºå…¨ç©º
            circleEl.style.strokeDashoffset = circleTotalLength;
        }

        // --- å‹•ç•«å¾ªç’° (æ¯ä¸€å¹€åŸ·è¡Œ) ---
        function animate(timestamp) {
            // å¦‚æœé‚„æ²’å®Œæˆï¼Œç¹¼çºŒç§»å‹•å’Œæª¢æ¸¬
            if (!isCompleted) {
                // 1. æ›´æ–°ä½ç½®
                posX += velX;
                posY += velY;

                // 2. é‚Šç•Œåå½ˆæª¢æ¸¬
                if (posX + objSize/2 > window.innerWidth || posX - objSize/2 < 0) {
                    velX *= -1; // Xè»¸åè½‰
                }
                if (posY + objSize/2 > window.innerHeight || posY - objSize/2 < 0) {
                    velY *= -1; // Yè»¸åè½‰
                }

                // 3. æ‡‰ç”¨ä½ç½®æ¨£å¼
                wrapper.style.left = `${posX}px`;
                wrapper.style.top = `${posY}px`;

                // 4. æ³¨è¦–è¨ˆæ™‚é‚è¼¯
                if (isGazing) {
                    if (!gazeStartTime) gazeStartTime = timestamp;
                    const elapsed = timestamp - gazeStartTime;
                    
                    // è¨ˆç®—é€²åº¦æ¯”ä¾‹ (0 åˆ° 1)
                    const progress = Math.min(elapsed / gazeDuration, 1);
                    // æ›´æ–° SVG åœ“ç’°
                    circleEl.style.strokeDashoffset = circleTotalLength - (progress * circleTotalLength);

                    // åˆ¤æ–·æ˜¯å¦å®Œæˆ
                    if (elapsed >= gazeDuration) {
                        completeItem();
                    }
                } else {
                    // å¦‚æœæ‰‹æŒ‡æ”¾é–‹ï¼Œé‡ç½®è¨ˆæ™‚
                    gazeStartTime = 0;
                    resetCircle();
                }
            }
            // è«‹æ±‚ä¸‹ä¸€å¹€
            requestAnimationFrame(animate);
        }

        // --- æˆåŠŸè™•ç† ---
        function completeItem() {
            isCompleted = true;
            
            // 1. è¦–è¦ºç‰¹æ•ˆï¼šé–ƒå…‰ + å½ˆè·³
            flashOverlay.classList.remove('flash-active');
            void flashOverlay.offsetWidth; // å¼·åˆ¶é‡ç¹ª
            flashOverlay.classList.add('flash-active');
            wrapper.classList.add('success-active');

            // 2. éš¨æ©Ÿè®šè³èªéŸ³
            const praise = praiseWords[Math.floor(Math.random() * praiseWords.length)];
            speak(`${items[currentIndex].name}ï¼${praise}ã€‚å¤§å®¶æ¯”å•²æŒè²ï¼`);
            
            // 3. éœ‡å‹•åé¥‹ (å¦‚æœè£ç½®æ”¯æ´)
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);

            // 4. å»¶é²é¡¯ç¤ºä¸‹ä¸€å€‹æŒ‰éˆ•
            setTimeout(() => {
                if (currentIndex < items.length - 1) {
                    nextBtn.style.display = 'block';
                } else {
                    finalCelebration();
                }
            }, 800);
        }

        function finalCelebration() {
            // å…¨é€šé—œæ…¶ç¥
            speak("å“‡ï¼ä½ å®Œæˆæ™’æ‰€æœ‰æŒ‘æˆ°å–‡ï¼å¥½å»å•Šï¼");
            createConfetti();
            
            // æŒçºŒå™´ç™¼çµ²å¸¶
            const interval = setInterval(createConfetti, 1000);
            
            // 6ç§’å¾Œé‡æ•´é é¢
            setTimeout(() => {
                clearInterval(interval);
                setTimeout(() => location.reload(), 5000);
            }, 6000);
        }

        // --- çµ²å¸¶ç”Ÿæˆé‚è¼¯ ---
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                // éš¨æ©Ÿä½ç½®èˆ‡é¡è‰²
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                // éš¨æ©Ÿå¤§å°
                confetti.style.width = (Math.random() * 10 + 5) + 'px';
                confetti.style.height = (Math.random() * 20 + 10) + 'px';
                // éš¨æ©Ÿè½ä¸‹é€Ÿåº¦
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confettiContainer.appendChild(confetti);
                
                // å‹•ç•«çµæŸå¾Œç§»é™¤ DOM
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        function nextItem() {
            currentIndex++;
            loadItem();
        }

        // --- TTS èªéŸ³åˆæˆ ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€å¥
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-HK'; // å»£æ±è©±
                utterance.rate = 1.0;
                utterance.pitch = 1.2; // ç¨å¾®èª¿é«˜éŸ³èª¿ï¼Œè½èµ·ä¾†è¼ƒè¦ªåˆ‡
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- è§¸æ§äº¤äº’äº‹ä»¶ ---
        // æ”¯æ´è§¸æ§å±
        wrapper.addEventListener('touchstart', (e) => { 
            isGazing = true; 
            e.preventDefault(); // é˜²æ­¢è§¸æ§æ™‚ç”¢ç”Ÿæ»‘å‹•
        });
        wrapper.addEventListener('touchend', () => { isGazing = false; });
        
        // æ”¯æ´æ»‘é¼  (æ–¹ä¾¿æ¸¬è©¦æˆ–é›»è…¦ä½¿ç”¨)
        wrapper.addEventListener('mousedown', () => { isGazing = true; });
        window.addEventListener('mouseup', () => { isGazing = false; });
    </script>
</body>
</html>